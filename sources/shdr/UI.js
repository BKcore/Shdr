// Generated by CoffeeScript 1.4.0
(function() {
  var UI;

  UI = (function() {

    function UI(app) {
      this.app = app;
      this.initSnippets();
      this.initModels();
      this.initMenus();
      this.initToggles();
    }

    UI.prototype.initToggles = function() {
      var _this = this;
      return $('.menu-toggle').on('click', function(e) {
        return _this.onToggle(e);
      });
    };

    UI.prototype.initMenus = function() {
      var _this = this;
      $('.menu-trigger').on('click.on', function(e) {
        return _this.onMenuTrigger(e);
      });
      return $('.menu-item').on('click', function(e) {
        return _this.onMenuItem(e);
      });
    };

    UI.prototype.initSnippets = function() {
      var button, key, list, _results;
      list = $('#menu-snippets .menu-list');
      button = $('<button>').addClass('menu-item');
      _results = [];
      for (key in shdr.Snippets) {
        _results.push(list.append(button.clone().text(key)));
      }
      return _results;
    };

    UI.prototype.initModels = function() {
      var button, key, list, model, _ref, _results;
      list = $('#menu-models .menu-list');
      button = $('<button>').addClass('menu-item');
      _ref = shdr.Models;
      _results = [];
      for (key in _ref) {
        model = _ref[key];
        _results.push(list.append(button.clone().text(model.name).attr('data-index', key)));
      }
      return _results;
    };

    UI.prototype.onToggle = function(event) {
      var el, ico, root, state, _name;
      el = $(event.target);
      root = el.parent();
      ico = el.children('i');
      state = el.attr('data-current') === el.attr('data-off');
      if (state === true) {
        el.attr('data-current', el.attr('data-on'));
        ico.removeClass(ico.attr('data-off'));
        ico.addClass(ico.attr('data-on'));
      } else {
        el.attr('data-current', el.attr('data-off'));
        ico.removeClass(ico.attr('data-on'));
        ico.addClass(ico.attr('data-off'));
      }
      if (typeof this[_name = root.attr('data-action') + 'Action'] === "function") {
        this[_name](state, null, el);
      }
      return this.app.editor.focus();
    };

    UI.prototype.onMenuTrigger = function(event) {
      var el, list, root,
        _this = this;
      el = $(event.target);
      root = el.parent();
      list = root.children('.menu-list');
      el.addClass('open');
      list.slideDown(200);
      $(document).on('click.menu-trigger', function() {
        return _this.offMenuTrigger(el, list);
      });
      el.off('click.on');
      el.on('click.off', function(e) {
        return _this.offMenuTrigger(el, list);
      });
      return event.stopPropagation();
    };

    UI.prototype.offMenuTrigger = function(el, list) {
      var _this = this;
      el.removeClass('open');
      el.off('click.off');
      el.blur();
      el.on('click.on', function(e) {
        return _this.onMenuTrigger(e);
      });
      list.slideUp(200);
      $(document).off('click.menu-trigger');
      return this.app.editor.focus();
    };

    UI.prototype.onMenuItem = function(event) {
      var el, index, item, list, root, _name;
      item = $(event.target);
      list = item.parent();
      root = list.parent();
      el = root.children('.menu-trigger');
      index = item.attr('data-index');
      if (typeof this[_name = root.attr('data-action') + 'Action'] === "function") {
        this[_name](index, item, el);
      }
      this.offMenuTrigger(el, list);
      return event.stopPropagation();
    };

    UI.prototype.updateAction = function(index, item, trigger) {
      trigger.html(item.html());
      return this.app.setUpdateMode(index);
    };

    UI.prototype.snippetsAction = function(index, item, trigger) {
      var code;
      code = shdr.Snippets[item.text()];
      if (code != null) {
        return this.app.editor.insert(code);
      }
    };

    UI.prototype.modelsAction = function(index, item, trigger) {
      trigger.children('span').text(item.text());
      return this.app.viewer.loadModel(index);
    };

    UI.prototype.rotateAction = function(state) {
      return this.app.viewer.rotate = state;
    };

    return UI;

  })();

  this.shdr || (this.shdr = {});

  this.shdr.UI = UI;

}).call(this);
